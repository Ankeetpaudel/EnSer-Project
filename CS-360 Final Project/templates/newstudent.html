<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/ae360af17e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/static/css/newcss.css">
</head>


<body>
    <div class="wrapper">
        <aside id="sidebar" class="js-sidebar">
            <div class="h-100">
                <div class="sidebar-logo">
                    <a href="#">Enser</a>
                </div>
                <ul class="sidebar-nav">
                    <li class="sidebar-header">Elements</li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="dashboard">
                            <i class="fa-solid fa-list pe-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="studentNotification">
                            <i class="fa-solid fa-file-lines pe-2"></i> Notification
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="projects">
                            <i class="fa-solid fa-file-lines pe-2"></i> Projects Available
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="projectsyllabus">
                            <i class="fa-regular fa-user pe-2"></i> Syllabus
                        </a>
                    </li>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="submission">
                            <i class="fa-regular fa-user pe-2"></i> Submission
                        </a>
                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="grades">
                            <i class="fa-regular fa-user pe-2"></i> Grades
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a href="#" class="sidebar-link" data-target="feedback">
                            <i class="fa-solid fa-comment-dots pe-2"></i> View Feedback
                        </a>
                    </li>


                    <li class="sidebar-item">
                        <a href="/logout" class=" button " id="logoutLink">
                            <i class="fa-solid fa-right-from-bracket pe-2"></i> Logout
                        </a>

                    </li>

                </ul>
            </div>
        </aside>

        <div class="main">
            <nav class="navbar navbar-expand px-3 border-bottom">
                <button class="btn" id="sidebar-toggle" type="button">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </nav>
            <main class="content px-3 py-2">
                <div class="container-fluid">
                    <div id="dashboard" class="content-section" style="display: none;">
                        <h4>Student Dashboard</h4>
                        <div class=" move-div col-md-1">
                            <img src="https://th.bing.com/th/id/OIP.8j0ii5H2775MylNnzX-lGwHaEo?rs=1&pid=ImgDetMain"
                                alt="student Image" height="300px" width="430px">
                        </div>
                        <div class="move1-div offset-md-5 col-md-4">
                            <h13>Welcome to the student Dashboard.</h13> <br><br>
                            <p11>Welcome to our community project hub! Here, members share project titles and detailed
                                descriptions to spark inspiration for students. Students can choose from a variety of
                                exciting projects, select one that resonates with them, and begin their journey. After
                                completing their project, students will showcase their work by uploading it and receive
                                constructive feedback from our supportive community. Let's collaborate, innovate, and
                                grow together!
                            </p11>


                        </div>
                    </div>


                    <div id="projects" class="content-section" style="display:none">
                        <div class="container mt-4">
                            <h2>Available Projects</h2>
                            <div class="card-body">
                                <h5 class="card-title">Select which field you want the project from:</h5>
                                <select id="projectDepartment" name="projectDepartment" class="form-control" required>
                                    <option value="">Please select a department</option>
                                    <option value="Civil Engineering">Civil Engineering</option>
                                    <option value="Mechanical Engineering">Mechanical Engineering</option>
                                    <option value="Electrical Engineering">Electrical Engineering</option>
                                    <option value="Computer Engineering">Computer Engineering</option>
                                    <option value="Chemical Engineering">Chemical Engineering</option>
                                    <option value="Aerospace Engineering">Aerospace Engineering</option>
                                    <option value="Nuclear Engineering">Nuclear Engineering</option>
                                    <option value="Biomedical Engineering">Biomedical Engineering</option>
                                    <option value="Industrial Engineering">Industrial Engineering</option>
                                    <option value="Environmental Engineering">Environmental Engineering</option>
                                </select>
                                <button type="button" class="btn btn-primary mt-3"
                                    onclick="fetchProjectDetails()">Search</button>
                            </div>
                            <!-- Project details section -->
                            <div id="projectDetails" class="project-details" style="display:none;">
                                <h3 id="projectTitle"></h3>
                                <p id="projectDescription"></p>
                            </div>
                        </div>
                    </div>


                </div>

                <div id="projectsyllabus" class="content-section" style="display:none;">
                    <div class="card">
                        <div class="container">
                            <h2>Review the Project Syllabus Here</h2>
                            <p class="title">You can see the detailed syllabus for projects here</p>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Professor First Name</th>
                                        <th>Professor Last Name</th>
                                        <th>Project Department</th>
                                        <th>Project Title</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="syllabusBody">
                                    <!-- Project syllabus details will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Modal for Viewing Project Syllabus Details -->
                <div class="modal fade" id="projectSyllabusModal" tabindex="-1"
                    aria-labelledby="projectSyllabusModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-fullscreen">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="projectSyllabusModalLabel">Project Syllabus Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <textarea id="syllabusText" class="form-control" rows="10" readonly></textarea>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="submission" class="content-section" style="display:none;">
                    <div class="card">
                        <div class="container">
                            <h2>Project Submissions</h2>
                            <p class="title">Submit your projects here.</p>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Professor First Name</th>
                                        <th>Professor Last Name</th>
                                        <th>Project Department</th>
                                        <th>Project Title</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="submissionBody">
                                    <!-- Submission details will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>




                <div id="grades" class="content-section" style="display:none;">
                    <div class="card">
                        <div class="container">
                            <h2>Your Grades</h2>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Professor First Name</th>
                                        <th>Professor Last Name</th>
                                        <th>Project Department</th>
                                        <th>Project Title</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="gradesBody">
                                    <!-- Grade entries will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>






                <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="uploadModalLabel">Upload Project Submission</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <form method="post" action="/submit_project" enctype="multipart/form-data">
                                    <input type="file" name="file" accept=".pdf">
                                    <input type="hidden" name="notification_id">
                                    <button type="submit" class="btn btn-primary">submit</button>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>





                <div id="professor" class="content-section" style="display:none;">
                    <div class="card">
                        <div class="container">
                            <h2>Professors</h2>
                            <p class="title">Choose your own Professor.</p>
                            <!-- Professor information -->
                        </div>
                    </div>
                </div>






                <div id="studentNotification" class="content-section" style="display:none;">
                    <div class="card">
                        <div class="container">
                            <h2>Notifications</h2>
                            <p class="title">View notifications regarding your requests here.</p>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Professor First Name</th>
                                        <th>Professor Last Name</th>
                                        <th>Project Department</th>
                                        <th>Project Title</th>

                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="notificationBody">
                                    <!-- Notification details will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>




        </div>
        </main>
        <a href="#" class="theme-toggle">
            <i class="fa-regular fa-moon"></i>
            <i class="fa-regular fa-sun"></i>
        </a>
    </div>
    </div>





    <!-- Modal for Viewing Detailed Grades -->
    <div class="modal fade" id="gradeDetailsModal" tabindex="-1" aria-labelledby="gradeDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="gradeDetailsModalLabel">Detailed Grades</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Criteria</th>
                                <th>Percentage</th>
                                <th>Grade</th>
                                <th>Feedback</th>
                            </tr>
                        </thead>
                        <tbody id="detailedGradesBody">
                            <!-- Detailed grades will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>







    <!-- Decision Modal -->
    <div class="modal fade" id="decisionModal" tabindex="-1" aria-labelledby="decisionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg"> <!-- Notice the modal-lg class here -->
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="decisionModalLabel">Notification Decision</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Your request has been rejected, please choose another professor.
                </div>
            </div>
        </div>
    </div>


    <div id="feedback" class="content-section" style="display:none;">
        <div class="card">
            <div class="container">
                <h2>Feedback</h2>
                <p class="title">View feedback for your projects.</p>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Project Title</th>
                            <th>Feedback Content</th>
                            <th>Date Received</th>
                        </tr>
                    </thead>
                    <tbody id="feedbackBody">
                        <!-- Dynamically loaded feedback entries will go here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- Modal for Viewing Project Details -->
    <div class="modal fade" id="projectDetailsModal" tabindex="-1" aria-labelledby="projectDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectDetailsModalLabel">Project Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4 id="modalProjectTitle"></h4>
                    <p id="modalProjectDescription"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing Feedback -->
    <div class="modal fade" id="feedbackDetailsModal" tabindex="-1" aria-labelledby="feedbackDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="feedbackDetailsModalLabel">Feedback Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="modalFeedbackContent"></p>
                    <p><strong>Date:</strong> <span id="modalFeedbackDate"></span></p>
                </div>
            </div>
        </div>
    </div>






    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/script.js"></script>


    <script>
        // Handles clicks on sidebar links to display the corresponding content section
        document.querySelectorAll('.sidebar-link').forEach(link => {

            link.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);

                // Hide all content sections
                document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');

                // Show the targeted content section
                if (targetElement) {
                    targetElement.style.display = 'block';
                }

                // Check if the clicked link is for the syllabus section and trigger the function
                if (targetId === 'projectsyllabus') {
                    fetchSyllabuses(); // Call the function to fetch syllabus details
                }
            });

        });



        function fetchProjectDetails() {
            var department = document.getElementById("projectDepartment").value;
            console.log("Selected Department:", department);

            if (!department) {
                alert("Please select a department");
                return;
            }
            fetch(`/api/projects/${department}`)
                .then(response => response.json())
                .then(projects => {
                    if (projects.length > 0) {
                        const projectDetails = projects.map(project =>
                            `<div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">${project.title}</h5>
                            <p class="card-text">${project.description}</p>
                            <p class="card-text"><small class="text-muted">Project ID: ${project.project_id}</small></p>
                            <div class="form-group">
                                <label for="selectProfessor${project.project_id}">Select Professor</label>
                                <select class="form-control" id="selectProfessor${project.project_id}">
                                    <option value="" disabled selected>Select Professor</option>
                                    ${project.professors.map(prof => `<option value="${prof.id}">${prof.name}</option>`).join('')}
                                </select>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="applyToProject(${project.project_id})">Apply</button>
                        </div>
                    </div>`
                        ).join("");
                        document.getElementById("projectDetails").innerHTML = projectDetails;
                        document.getElementById("projectDetails").style.display = "block";
                    } else {
                        document.getElementById("projectDetails").innerHTML = "<p>No projects found for this department.</p>";
                        document.getElementById("projectDetails").style.display = "block";
                    }
                })
                .catch(error => {
                    console.error('Error fetching project details:', error);
                    document.getElementById("projectDetails").innerHTML = "<p>Error fetching project details.</p>";
                    document.getElementById("projectDetails").style.display = "block";
                });
        }



        function applyToProject(projectId) {
            console.log("Apply to project ID:", projectId);

            // Collect the selected professor
            var professorSelect = document.getElementById(`selectProfessor${projectId}`);
            var professorId = professorSelect.value;

            if (!professorId) {
                alert("Please select a professor before applying.");
                return;
            }

            // Send the data to the server update the UI based on the response
            fetch(`/api/apply/${projectId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    projectId: projectId,
                    professorId: professorId,
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    alert('Application submitted successfully!');


                    document.getElementById(`selectProfessor${projectId}`).remove();
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Error submitting application.');
                });
        }





        function fetchSyllabuses() {
            fetch('/api/student/delivered_syllabuses')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Failed to fetch syllabuses:', data.error);
                        alert('Failed to load syllabuses.');
                    } else {
                        const syllabusBody = document.getElementById('syllabusBody');
                        syllabusBody.innerHTML = ''; // Clear existing entries

                        data.forEach(syllabus => {
                            const row = `
                        <tr>
                            <td>${syllabus.professor_first_name}</td>
                            <td>${syllabus.professor_last_name}</td>
                            <td>${syllabus.project_department}</td>  
                            <td>${syllabus.project_title}</td>
                            <td>${syllabus.project_description}</td>
                            <td>
                                <button onclick="viewSyllabusDetails(${syllabus.notification_id})" class="btn btn-primary">View</button>
                            </td>
                        </tr>
                    `;
                            syllabusBody.innerHTML += row;
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching syllabuses:', error);
                });
        }

        function viewSyllabusDetails(notificationId) {
            fetch(`/api/syllabus/${notificationId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const syllabusText = document.getElementById('syllabusText');
                    if (data.auto_syllabus) {
                        syllabusText.value = data.auto_syllabus;  // Populate the textarea with syllabus content
                    } else {
                        syllabusText.value = 'No syllabus details available.';  // Handle missing syllabus details
                    }
                    // Show the modal
                    var syllabusModal = new bootstrap.Modal(document.getElementById('projectSyllabusModal'));
                    syllabusModal.show();
                })
                .catch(error => {
                    console.error('Error loading syllabus:', error);
                    document.getElementById('syllabusText').value = 'Failed to load syllabus details.';
                });
        }




        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-target');
                document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.style.display = 'block';
                }
                if (targetId === 'submission') {
                    fetchSubmissions();
                }
            });
        });


        function fetchSubmissions() {
            fetch('/api/student/delivered_syllabuses')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Failed to fetch submissions:', data.error);
                        alert('Failed to load submissions.');
                    } else {
                        const submissionBody = document.getElementById('submissionBody');
                        submissionBody.innerHTML = ''; // Clear existing entries

                        data.forEach(submission => {
                            const row = `
                        <tr>
                            <td>${submission.professor_first_name}</td>
                            <td>${submission.professor_last_name}</td>
                            <td>${submission.project_department}</td>  
                            <td>${submission.project_title}</td>
                            <td>${submission.project_description}</td>
                            <td>
                                <button onclick="uploadSubmission(${submission.notification_id})" class="btn btn-primary">Upload Here</button>
                            </td>
                        </tr>
                    `;
                            submissionBody.innerHTML += row;
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching submissions:', error);
                });
        }


        function uploadSubmission(notificationId) {
            document.querySelector('#uploadModal input[name="notification_id"]').value = notificationId;
            var uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
            uploadModal.show();
        }






        document.querySelector('#uploadModal form').addEventListener('submit', function (event) {
            event.preventDefault();
            var formData = new FormData(this);

            // Correctly making a fetch request within the submit event listener
            fetch('/api/submit_project', {
                method: 'POST',
                body: formData,
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Server responded with an error!');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    alert('File submitted successfully!');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error submitting file.');
                });
        });



        document.addEventListener('DOMContentLoaded', function () {
            fetchGradedProjects();
        });

        function fetchGradedProjects() {
            fetch('/api/graded_projects')
                .then(response => response.json())
                .then(data => {
                    populateGradesTable(data);
                })
                .catch(error => {
                    console.error('Error fetching graded projects:', error);
                });
        }

        function populateGradesTable(gradedProjects) {
            const tableBody = document.getElementById('gradesBody');
            tableBody.innerHTML = ''; // Clear existing table data

            gradedProjects.forEach(project => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${project.professor_first_name}</td>
            <td>${project.professor_last_name}</td>
            <td>${project.project_department}</td>
            <td>${project.project_title}</td>
            <td>${project.description}</td>
            <td>
    <button onclick="viewProjectResults('${project.submission_id}')" class="btn btn-success text-white">
        <i class="fas fa-eye"></i> View Result
    </button>
</td>

        `;
                tableBody.appendChild(row);
            });
        }





        function viewProjectResults(submissionId) {
            fetch(`/api/grades/${submissionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) { // this response is an array of grades
                        populateGradeDetailsModal(data);
                    } else {
                        console.error('No grades found');
                    }
                })
                .catch(error => {
                    console.error('Error fetching grade details:', error);
                });
        }

        function populateGradeDetailsModal(grades) {
            const tableBody = document.getElementById('detailedGradesBody');
            tableBody.innerHTML = '';  // Clear existing table data

            grades.forEach(grade => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${grade.criterion_name}</td>
            <td>${grade.percentage}</td>
            <td>${grade.assigned_score}%</td>
            <td>${grade.comments}</td>
        `;
                tableBody.appendChild(row);
            });


            if (grades[0].total_score !== null) {
                const totalScoreRow = document.createElement('tr');
                totalScoreRow.innerHTML = `
            <td colspan="3">Total Score</td>
            <td>${grades[0].total_score}%</td>
        `;
                tableBody.appendChild(totalScoreRow);
            }

            // Show the modal
            var gradeDetailsModal = new bootstrap.Modal(document.getElementById('gradeDetailsModal'));
            gradeDetailsModal.show();
        }





        document.addEventListener('DOMContentLoaded', function () {
            // Call other necessary functions like fetching notifications, etc.
            fetchNotifications();

            // Set the dashboard to be visible initially
            const dashboard = document.getElementById('dashboard');
            if (dashboard) {
                dashboard.style.display = 'block';
            }

            // Highlight the dashboard link in the sidebar as active
            const dashboardLink = document.querySelector('.sidebar-link[data-target="dashboard"]');
            if (dashboardLink) {
                dashboardLink.classList.add('active');
            }
        });






        function fetchNotifications() {
            fetch('/api/student/rejected_notifications')  // Updated to the correct endpoint
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP status ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const notificationBody = document.getElementById('notificationBody');
                    notificationBody.innerHTML = '';
                    data.forEach(notification => {
                        const row = `
                    <tr>
                        <td>${notification.professor_first_name}</td>
                        <td>${notification.professor_last_name}</td>
                        <td>${notification.project_department}</td>
                        <td>${notification.project_title}</td>
                       
                        <td>
                            <button onclick="showDecisionModal(${notification.notification_id})" class="btn btn-info">Decision</button>
                        </td>
                    </tr>
                `;
                        notificationBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error('Error fetching notifications:', error);
                });
        }






        function showDecisionModal(notificationId) {

            var decisionModal = new bootstrap.Modal(document.getElementById('decisionModal'));
            decisionModal.show();
        }






        document.addEventListener('DOMContentLoaded', function () {
            const sidebarLinks = document.querySelectorAll('.sidebar-link');

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function () {
                    // Remove active class from all links
                    sidebarLinks.forEach(l => l.classList.remove('active'));

                    // Add active class to the clicked link
                    this.classList.add('active');
                });
            });
        });


        function fetchFeedback() {
            fetch('/api/get_feedback')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const feedbackBody = document.getElementById('feedbackBody');
                    feedbackBody.innerHTML = '';  // Clear previous entries
                    data.forEach(feedback => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                    <td>${feedback.project_title}</td>
                    <td>${feedback.content}</td>
                    <td>${feedback.date_received}</td>
                `;
                        feedbackBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error fetching feedback:', error);
                    alert('Failed to load feedback: ' + error.message);
                });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const feedbackLink = document.querySelector('.sidebar-link[data-target="feedback"]');
            feedbackLink.addEventListener('click', fetchFeedback);
        });

        function viewProjectDetails(projectId) {
            // Fetch the project details from the server
            fetch(`/api/projects/${projectId}`)
                .then(response => response.json())
                .then(project => {
                    document.getElementById('modalProjectTitle').textContent = project.title;
                    document.getElementById('modalProjectDescription').textContent = project.description;
                    // Show the modal
                    var projectDetailsModal = new bootstrap.Modal(document.getElementById('projectDetailsModal'));
                    projectDetailsModal.show();
                })
                .catch(error => {
                    console.error('Error fetching project details:', error);
                    alert('Failed to load project details: ' + error.message);
                });
        }

        function viewFeedbackDetails(feedbackId) {
            // Fetch the feedback details from the server
            fetch(`/api/feedback/${feedbackId}`)
                .then(response => response.json())
                .then(feedback => {
                    document.getElementById('modalFeedbackContent').textContent = feedback.content;
                    document.getElementById('modalFeedbackDate').textContent = new Date(feedback.date_received).toLocaleDateString();
                    // Show the modal
                    var feedbackDetailsModal = new bootstrap.Modal(document.getElementById('feedbackDetailsModal'));
                    feedbackDetailsModal.show();
                })
                .catch(error => {
                    console.error('Error fetching feedback details:', error);
                    alert('Failed to load feedback details: ' + error.message);
                });
        }






    </script>


</body>

</html>